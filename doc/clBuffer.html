<!DOCTYPE html><html lang="en"><head><title>clBuffer</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="clBuffer"><meta name="groc-project-path" content="lib/clBuffer.js"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/clBuffer.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);
<span class="hljs-keyword">var</span> ref = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ref'</span>);
<span class="hljs-keyword">var</span> Promise = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bluebird'</span>);
<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>);
<span class="hljs-keyword">var</span> CLMemory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./clMemory'</span>);
<span class="hljs-keyword">var</span> clUtils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./clUtils'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CLBuffer</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        CLBuffer2.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    }
    <span class="hljs-keyword">else</span> {
        CLBuffer1.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CLBuffer1</span><span class="hljs-params">(context, flags, dataSize, hostPtr)</span> </span>{
    hostPtr = hostPtr || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> cl = context.cl;
    <span class="hljs-keyword">var</span> err = ref.alloc(cl.types.ErrorCode);
    <span class="hljs-keyword">var</span> handle = cl.imports.clCreateBuffer(clUtils.toHandle(context), flags, dataSize, clUtils.toPtr(hostPtr, <span class="hljs-string">'hostPtr'</span>), err);
    cl.checkError(err);
    CLMemory.call(<span class="hljs-keyword">this</span>, context, handle);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CLBuffer2</span><span class="hljs-params">(context, handle)</span> </span>{
    CLMemory.call(<span class="hljs-keyword">this</span>, context, handle);
}

CLBuffer._wrap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(context, readOrWriteOnly, hostPtr)</span> </span>{
    <span class="hljs-keyword">var</span> ptr = clUtils.toPtr(hostPtr, <span class="hljs-string">'hostPtr'</span>);
    <span class="hljs-keyword">var</span> flags = context.cl.defs.CL_MEM_USE_HOST_PTR;
    <span class="hljs-keyword">if</span> (readOrWriteOnly === <span class="hljs-string">'readOnly'</span>) {
        flags |= context.cl.defs.CL_MEM_READ_ONLY;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (readOrWriteOnly === <span class="hljs-string">'writeOnly'</span>) {
        flags |= context.cl.defs.CL_MEM_WRITE_ONLY;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CLBuffer(context, flags, ptr.length, ptr);
};

CLBuffer.wrap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(context, hostPtr)</span> </span>{
    <span class="hljs-keyword">return</span> CLBuffer._wrap(context, <span class="hljs-literal">null</span>, hostPtr);
};

CLBuffer.wrapReadOnly = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(context, hostPtr)</span> </span>{
    <span class="hljs-keyword">return</span> CLBuffer._wrap(context, <span class="hljs-string">'readOnly'</span>, hostPtr);
};

CLBuffer.wrapWriteOnly = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(context, hostPtr)</span> </span>{
    <span class="hljs-keyword">return</span> CLBuffer._wrap(context, <span class="hljs-string">'writeOnly'</span>, hostPtr);
};

util.inherits(CLBuffer, CLMemory);

<span class="hljs-built_in">Object</span>.defineProperties(CLBuffer.prototype, {
    offset: {
        get: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>._throwIfReleased();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._getInfo(<span class="hljs-string">'size_t'</span>, <span class="hljs-keyword">this</span>.cl.defs.CL_MEM_OFFSET);
        }
    },
    superBuffer: {
        get: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>._throwIfReleased();
            <span class="hljs-keyword">var</span> subHandle = <span class="hljs-keyword">this</span>._getInfo(<span class="hljs-keyword">this</span>.cl.types.Mem, <span class="hljs-keyword">this</span>.cl.defs.CL_MEM_ASSOCIATED_MEMOBJECT);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CLBuffer(subHandle);
        }
    }
});

CLBuffer.prototype.createSubBuffer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(flags, origin, size)</span> </span>{
    <span class="hljs-keyword">this</span>._throwIfReleased();
    <span class="hljs-keyword">var</span> reg = <span class="hljs-keyword">new</span> (<span class="hljs-keyword">this</span>.cl.types.BufferRegion)();
    reg.origin = origin;
    reg.size = size;
    <span class="hljs-keyword">var</span> pReg = reg.ref();
    <span class="hljs-keyword">var</span> err = ref.alloc(<span class="hljs-keyword">this</span>.cl.types.ErrorCode);
    <span class="hljs-keyword">var</span> subHandle = <span class="hljs-keyword">this</span>.cl.imports.clCreateSubBuffer(<span class="hljs-keyword">this</span>.handle, flags, <span class="hljs-keyword">this</span>.cl.defs.CL_BUFFER_CREATE_TYPE_REGION, pReg, err);
    <span class="hljs-keyword">this</span>.cl.checkError(err);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CLBuffer(<span class="hljs-keyword">this</span>.context, subHandle);
};

<span class="hljs-built_in">module</span>.exports = CLBuffer;</div></div></div></div></body></html>